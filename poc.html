<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Proof of Concept</title>
    <!-- Load required JS files for amCharts to run -->
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/maps.js"></script>
    <script src="https://www.amcharts.com/lib/4/geodata/worldLow.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
</head>
<body>
    <script>
        // let geocodes;
        // fetch("data/geocodes.json").then(resp => resp.json()).then(json => geocodes = json);
        let initialPurposeCut = "All purposes of travel";
        let initialLengthCut = "All lengths of stay";

        let mapChart = am4core.create("map", am4maps.MapChart);
        mapChart.geodata = am4geodata_worldLow;
        mapChart.projection = new am4maps.projections.EqualEarth();
        mapChart.deltaLongitude = -160;
        mapChart.panBehavior = "none";

        let polygons = mapChart.series.push(new am4maps.MapPolygonSeries());
        polygons.useGeodata = true;
        polygons.exclude = ["AQ"];

        let nodes = mapChart.series.push(new am4maps.MapImageSeries());
        let nodeTemplate = nodes.mapImages.template;
        nodeTemplate.propertyFields.latitude = "Latitude";
        nodeTemplate.propertyFields.longitude = "Longitude";
        nodeTemplate.propertyFields.title = "Name";
        let circle = nodeTemplate.createChild(am4core.Circle);
        circle.radius = 1;
        circle.fill = am4core.color("#000000");
        circle.tooltipText = "{title}";
        nodes.dataSource.url = "data/geocodes.json";
        nodes.dataSource.parser = new am4core.JSONParser();
        nodes.dataSource.parser.options.emptyAs = 0;

        // let edges = mapChart.series.push(new am4maps.MapLineSeries());
        // edges.dataSource.url = "data/allData.json";
        // edges.dataSource.parser = new am4core.JSONParser();
        // edges.dataSource.parser.options.emptyAs = 0;
        // edges.dataSource.events.on("parseended", ev => {
        //     let rootData = ev.target.data;
        //     let cutData = rootData[initialPurposeCut][initialLengthCut];
        //     let latestData = cutData[cutData.length-1].data;
        //     ev.target.data = [];
        // });
    </script>
    <div id="map" style="width: 100%; height: 800px;"></div>
</body>
</html>